name: turbo_packages
publish_to: none

environment:
  sdk: ^3.6.0

workspace:
  - turbo_response
  - turbo_serializable
  - turbo_notifiers
  - turbo_mvvm
  - turbolytics
  - turbo_firestore_api
  - turbo_promptable
  - turbo_template/flutter-app

dev_dependencies:
  melos: ^7.3.0

melos:
  repository: https://github.com/appboypov/turbo_packages

  command:
    version:
      workspaceChangelog: true
      linkToCommits: true

  scripts:
    analyze:
      run: dart analyze --fatal-infos
      exec:
        concurrency: 1
      description: Run dart analyze

    format:
      run: dart format --set-exit-if-changed .
      description: Check formatting

    test:
      run: bash "$MELOS_ROOT_PATH/tool/test_with_coverage.sh"
      exec:
        concurrency: 1
      packageFilters:
        dirExists: test
      description: Run tests with coverage

    build_runner:
      run: dart run build_runner build --delete-conflicting-outputs
      exec:
        concurrency: 1
      packageFilters:
        dependsOn: build_runner
      description: Run build_runner

    pub-check:
      run: bash "$MELOS_ROOT_PATH/tool/pub_check.sh"
      exec:
        concurrency: 1
      packageFilters:
        ignore:
          - turbo_flutter_template
      description: Validate packages meet 160/160 pub.dev points using pana

    pub-publish:
      run: bash "$MELOS_ROOT_PATH/tool/pub_publish.sh" --confirmed
      exec:
        concurrency: 1
      packageFilters:
        ignore:
          - turbo_flutter_template
      description: Validate and publish packages to pub.dev (requires confirmation)

    pub-publish-dry-run:
      run: bash "$MELOS_ROOT_PATH/tool/pub_publish.sh" --dry-run
      exec:
        concurrency: 1
      packageFilters:
        ignore:
          - turbo_flutter_template
      description: Validate packages for publishing without actually publishing (dry-run)
